services:
  pubmed-mcp:
    build:
      context: ../pubmed-mcp-server
      dockerfile: Dockerfile
    image: pubmed-mcp:local
    container_name: pubmed-mcp-server
    ports:
      - "3017:3017"
    environment:
      - PORT=3017
      # - MCP_LOG_LEVEL=warning
      - MCP_TRANSPORT_TYPE=http
      - MCP_HTTP_PORT=3017
    networks:
      - mcp-network
    restart: unless-stopped

  clinical-trials-mcp:
    build:
      context: ../clinicaltrialsgov-mcp-server
      dockerfile: Dockerfile
    image: clinicaltrialsgov-mcp:local
    container_name: clinicaltrialsgov-mcp-server
    ports:
      - "3018:3018"
    environment:
      - MCP_HTTP_PORT=3018
      # - LOG_LEVEL=warn
    networks:
      - mcp-network
    restart: unless-stopped

  pipeline:
    build:
      context: .
      dockerfile: Dockerfile.pipeline
    image: dod-deep-research:local
    entrypoint: ["uv", "run", "python", "-m", "dod_deep_research.deep_research"]
    env_file:
      - .env
    environment:
      - PUBMED_MCP_URL=http://pubmed-mcp:3017/mcp
      - CLINICAL_TRIALS_MCP_URL=http://clinical-trials-mcp:3018/mcp
      - EXA_MCP_URL=${EXA_MCP_URL:-}
      - EXA_API_KEY=${EXA_API_KEY:-}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY:-}
    depends_on:
      - pubmed-mcp
      - clinical-trials-mcp
    networks:
      - mcp-network
    profiles:
      - pipeline

networks:
  mcp-network:
    driver: bridge
